---
phase: 05-visuals-deploy
plan: 01
type: execute
---

<objective>
Add day/night cycle with dynamic lighting, visual polish, and deploy to Vercel.

Purpose: Complete the game with atmospheric lighting and make it publicly accessible.
Output: Deployed game at Vercel URL with animated day/night cycle and polished visuals.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Relevant source files:**
@src/scene.ts

**Prior decisions affecting this phase:**
- Sky blue background (0x87CEEB) already set
- Fog 100-300 units already configured
- Ambient (0.6) + directional (0.8) lights established
- Vite build working (`npm run build`)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement day/night cycle system</name>
  <files>src/scene.ts, src/daynight.ts</files>
  <action>
Create src/daynight.ts module that manages time-of-day:
- DayNightCycle class with `timeOfDay` (0-1, where 0.25=noon, 0.75=midnight)
- `update(deltaTime)` advances time (full cycle ~2 minutes for demo)
- `getSunPosition()` returns Vector3 for directional light (arc across sky)
- `getSkyColor()` returns color interpolated: day (0x87CEEB) → sunset (0xFF7F50) → night (0x0a0a20)
- `getFogColor()` matches sky color
- `getAmbientIntensity()` returns 0.6 day → 0.2 night
- `getDirectionalIntensity()` returns 0.8 day → 0.1 night (moon)

In scene.ts:
- Import and instantiate DayNightCycle
- In animate loop: call cycle.update(deltaTime)
- Update directionalLight.position from getSunPosition()
- Update scene.background, scene.fog.color from getSkyColor/getFogColor
- Update light intensities

Use smooth sine-based interpolation for gradual transitions. Avoid abrupt color changes.
  </action>
  <verify>npm run dev - sky transitions smoothly from blue to orange/pink sunset to dark night and back to dawn</verify>
  <done>Day/night cycle animates continuously with smooth lighting, sky, and fog color transitions</done>
</task>

<task type="auto">
  <name>Task 2: Add visual polish</name>
  <files>src/chunk/Chunk.ts, src/car.ts</files>
  <action>
Building improvements in Chunk.ts:
- Add color variation per building: sample 3-4 building colors (gray, beige, blue-gray, warm gray) randomly
- Use MeshLambertMaterial (already has it) with color variation

Car improvements in car.ts:
- Give car body a brighter color (red or orange) so it stands out
- Add simple headlights as small emissive spheres at front (visible at night)

Keep changes minimal - this is polish, not a redesign.
  </action>
  <verify>npm run dev - buildings show color variation, car is visually distinct, headlights glow at night</verify>
  <done>Buildings have varied colors, car has bright color and visible headlights</done>
</task>

<task type="auto">
  <name>Task 3: Deploy to Vercel</name>
  <files>vercel.json</files>
  <action>
1. Run `npm run build` to verify production build works
2. Run `vercel --yes` to create project and deploy
3. Capture deployment URL from output
4. Run `vercel --prod` to promote to production
5. Verify with `curl {url}` returns 200
  </action>
  <verify>vercel ls shows deployment, curl returns 200, site loads in browser</verify>
  <done>Game deployed and accessible at Vercel URL</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Deployed game with day/night cycle to Vercel</what-built>
  <how-to-verify>
    1. Visit the Vercel deployment URL
    2. Confirm game loads without errors
    3. Drive around - verify procedural city spawns
    4. Watch sky - confirm day/night cycle animates (full cycle ~2 min)
    5. Check night time - car headlights visible, dark sky, low lighting
    6. Verify traffic AI cars present and moving
    7. Test on mobile browser if possible (optional)
  </how-to-verify>
  <resume-signal>Type "approved" to complete phase, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] Day/night cycle animates smoothly
- [ ] Building colors varied
- [ ] Car headlights visible at night
- [ ] Game deployed and publicly accessible on Vercel
- [ ] All prior functionality still works (driving, collision, traffic)
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Game publicly accessible at Vercel URL
- Day/night cycle provides atmospheric lighting changes
- PROJECT.md success criteria met: day/night cycle, deployed to Vercel
</success_criteria>

<output>
After completion, create `.planning/phases/05-visuals-deploy/05-01-SUMMARY.md`:

# Phase 5 Plan 1: Visuals & Deploy Summary

**[Substantive one-liner about what shipped]**

## Performance
- **Duration:** X min
- **Started:** [timestamp]
- **Completed:** [timestamp]
- **Tasks:** 4
- **Files modified:** X

## Accomplishments
- [Key outcomes]

## Files Created/Modified
- `path/to/file.ts` - Description

## Decisions Made
[Key decisions and rationale]

## Deviations from Plan
[Any changes from plan, or "None"]

## Issues Encountered
[Problems and resolutions, or "None"]

## Next Phase Readiness
- Phase 5 complete - project v1 finished
- All PROJECT.md success criteria met
- Game deployed at [URL]

---
*Phase: 05-visuals-deploy*
*Completed: [date]*
</output>
