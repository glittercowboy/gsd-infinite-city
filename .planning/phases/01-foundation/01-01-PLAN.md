---
phase: 01-foundation
plan: 01
type: execute
---

<objective>
Set up a working Three.js scene with a driveable car.

Purpose: Establish project foundation with build tooling and core game mechanics.
Output: Running Vite dev server with a 3D scene where arrow keys control a car.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

**Prior decisions affecting this phase:**
- TypeScript for type safety with complex game logic
- Arcade physics - fun over realism, forgiving controls
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Vite + TypeScript + Three.js project</name>
  <files>package.json, tsconfig.json, index.html, src/main.ts, vite.config.ts</files>
  <action>
    1. Initialize npm project with `npm init -y`
    2. Install dependencies: `npm install three` and `npm install -D typescript vite @types/three`
    3. Create tsconfig.json with strict mode, ES2020 target, moduleResolution: bundler
    4. Create vite.config.ts with basic config
    5. Create index.html with canvas mount point and module script tag pointing to /src/main.ts
    6. Create src/main.ts with placeholder console.log

    Use ES modules throughout. No CommonJS.
  </action>
  <verify>npm run dev starts Vite server at localhost:5173, browser console shows placeholder log</verify>
  <done>Vite dev server runs, TypeScript compiles, Three.js importable</done>
</task>

<task type="auto">
  <name>Task 2: Create basic Three.js scene</name>
  <files>src/main.ts, src/scene.ts</files>
  <action>
    1. Create src/scene.ts exporting a setupScene function that:
       - Creates WebGLRenderer with antialias, attached to document body
       - Creates PerspectiveCamera (fov 75, aspect from window, near 0.1, far 1000)
       - Creates Scene with sky-blue background color
       - Adds AmbientLight (soft white, intensity 0.5)
       - Adds DirectionalLight (white, intensity 1, position 10,20,10)
       - Adds ground plane (PlaneGeometry 100x100, green MeshStandardMaterial, rotated -90Â° on X)
       - Returns { renderer, camera, scene }
    2. In main.ts, import and call setupScene
    3. Create animation loop with requestAnimationFrame that calls renderer.render(scene, camera)
    4. Add window resize handler to update camera aspect and renderer size

    Camera should start at position (0, 5, 10) looking at origin.
  </action>
  <verify>npm run dev shows green ground plane with blue sky background</verify>
  <done>Scene renders with ground, sky, and lighting visible</done>
</task>

<task type="auto">
  <name>Task 3: Add driveable car with keyboard controls</name>
  <files>src/car.ts, src/input.ts, src/main.ts</files>
  <action>
    1. Create src/car.ts exporting:
       - createCar(): Creates car as Group with BoxGeometry body (2x1x4, red) and 4 cylinder wheels (black)
       - Car has properties: position, rotation, speed (starts 0), maxSpeed (0.3), acceleration (0.01), turnSpeed (0.03)
       - updateCar(car, input): Updates car position/rotation based on input state
         - W/ArrowUp: accelerate forward (speed += acceleration, capped at maxSpeed)
         - S/ArrowDown: accelerate backward (speed -= acceleration, capped at -maxSpeed/2)
         - A/ArrowLeft: turn left when moving (rotation.y += turnSpeed * sign(speed))
         - D/ArrowRight: turn right when moving (rotation.y -= turnSpeed * sign(speed))
         - No input: friction reduces speed toward 0
         - Apply speed in direction car is facing

    2. Create src/input.ts exporting:
       - InputState type: { forward, backward, left, right } all booleans
       - setupInput(): Returns InputState object, adds keydown/keyup listeners
       - Updates InputState on WASD and arrow key events

    3. In main.ts:
       - Import and create car, add to scene
       - Import and setup input
       - In animation loop, call updateCar with current input state
       - Make camera follow car: position behind and above car, lookAt car

    Camera follow: offset (0, 5, 10) relative to car, smooth follow optional but not required.
  </action>
  <verify>Arrow keys/WASD move car around ground plane, camera follows</verify>
  <done>Car drives with arcade physics, camera tracks car movement</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run dev` starts without errors
- [ ] `npm run build` succeeds (add build script if missing)
- [ ] TypeScript has no errors (`npx tsc --noEmit`)
- [ ] Car moves forward/backward with W/S or Up/Down arrows
- [ ] Car turns left/right with A/D or Left/Right arrows
- [ ] Camera follows car smoothly
- [ ] Ground plane visible, scene lit correctly
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Playable driving experience in browser
- Foundation ready for procedural city generation (Phase 2)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`:

# Phase 1 Plan 1: Foundation Summary

**[One-liner describing what shipped]**

## Accomplishments
- [Key outcome 1]
- [Key outcome 2]

## Files Created/Modified
- `path/to/file.ts` - Description

## Decisions Made
[Key decisions and rationale, or "None"]

## Issues Encountered
[Problems and resolutions, or "None"]

## Next Step
Ready for Phase 2: Procedural City
</output>
